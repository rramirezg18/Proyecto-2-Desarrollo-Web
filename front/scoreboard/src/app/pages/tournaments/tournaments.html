<h2>üèÜ Gesti√≥n de Torneos</h2>

<form [formGroup]="form" class="tourn-form">
  <div class="row">
    <mat-form-field appearance="outline">
      <mat-label>Equipo local</mat-label>
      <mat-select formControlName="homeTeamId" (selectionChange)="onHomeTeamChange()">
        <mat-option [value]="null">‚Äî Seleccionar ‚Äî</mat-option>
        <mat-option *ngFor="let t of teams()" [value]="t.id">{{ t.name }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Equipo visitante</mat-label>
      <mat-select formControlName="awayTeamId" (selectionChange)="onAwayTeamChange()">
        <mat-option [value]="null">‚Äî Seleccionar ‚Äî</mat-option>
        <mat-option *ngFor="let t of teams()" [value]="t.id">{{ t.name }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Fecha del partido</mat-label>
      <input matInput [matDatepicker]="dp" formControlName="dateMatch" />
      <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
      <mat-datepicker #dp></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Duraci√≥n del cuarto (seg)</mat-label>
      <input matInput type="number" formControlName="quarterDurationSeconds" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Estado</mat-label>
      <mat-select formControlName="status">
        <mat-option value="Programado">Programado</mat-option>
        <mat-option value="Live">Live</mat-option>
        <mat-option value="Finished">Finished</mat-option>
        <mat-option value="Canceled">Canceled</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="row">
    <mat-form-field appearance="outline" class="roster">
      <mat-label>Roster Local</mat-label>
      <mat-select formControlName="homeRoster" multiple>
        <mat-option *ngFor="let p of homePlayers()" [value]="p.id">{{ p.name }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="roster">
      <mat-label>Roster Visitante</mat-label>
      <mat-select formControlName="awayRoster" multiple>
        <mat-option *ngFor="let p of awayPlayers()" [value]="p.id">{{ p.name }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <button mat-raised-button color="primary" (click)="programMatch()" [disabled]="form.invalid">
    Programar partido
  </button>
</form>

<hr />

<!-- Toolbar de listado: b√∫squeda + total -->
<div class="list-toolbar">
  <mat-form-field appearance="outline" class="search">
    <mat-label>Buscar partido</mat-label>
    <input matInput placeholder="Equipo o estado‚Ä¶" [formControl]="search" />
  </mat-form-field>

  <div class="spacer"></div>
  <div class="total" *ngIf="!loading()">Total: {{ paginatorLength() }}</div>
</div>

<!-- Estado de carga -->
<div class="loading" *ngIf="loading()">Cargando partidos‚Ä¶</div>

<!-- Tabla (usa las filas filtradas rows()) -->
<table mat-table [dataSource]="rows()" class="mat-elevation-z1 full" *ngIf="!loading()">

  <!-- Fecha -->
  <ng-container matColumnDef="dateMatch">
    <th mat-header-cell *matHeaderCellDef> Fecha </th>
    <td mat-cell *matCellDef="let row">{{ row.dateMatch | date:'medium' }}</td>
  </ng-container>

  <!-- Estado -->
  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef> Estado </th>
    <td mat-cell *matCellDef="let row">{{ row.status }}</td>
  </ng-container>

  <!-- Local -->
  <ng-container matColumnDef="home">
    <th mat-header-cell *matHeaderCellDef> Local </th>
    <td mat-cell *matCellDef="let row">{{ row.homeTeam }}</td>
  </ng-container>

  <!-- Visita -->
  <ng-container matColumnDef="away">
    <th mat-header-cell *matHeaderCellDef> Visita </th>
    <td mat-cell *matCellDef="let row">{{ row.awayTeam }}</td>
  </ng-container>

  <!-- Marcador -->
  <ng-container matColumnDef="score">
    <th mat-header-cell *matHeaderCellDef> Marcador </th>
    <td mat-cell *matCellDef="let row">{{ row.homeScore }} - {{ row.awayScore }}</td>
  </ng-container>

  <!-- Faltas -->
  <ng-container matColumnDef="fouls">
    <th mat-header-cell *matHeaderCellDef> Faltas </th>
    <td mat-cell *matCellDef="let row">{{ row.homeFouls }} - {{ row.awayFouls }}</td>
  </ng-container>

  <!-- Acciones -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef> Acciones </th>
    <td mat-cell *matCellDef="let row">
      <button mat-stroked-button color="primary"
              [routerLink]="['/control', row.id]"
              *ngIf="row.status === 'Scheduled' || row.status === 'Live'">
        Jugar
      </button>

      <button mat-stroked-button color="accent"
              (click)="finishSim(row)"
              *ngIf="row.status !== 'Finished'">
        Simular y finalizar
      </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>

<!-- Vac√≠o -->
<div class="empty" *ngIf="!loading() && rows().length === 0">
  No hay partidos para mostrar.
</div>

<!-- Paginador (usa longitud real seg√∫n filtro/servidor) -->
<mat-paginator
  [length]="paginatorLength()"
  [pageIndex]="pageIndex()"
  [pageSize]="pageSize()"
  [pageSizeOptions]="[5, 10, 20, 50]"
  [showFirstLastButtons]="true"
  (page)="pageChange($event)">
</mat-paginator>
